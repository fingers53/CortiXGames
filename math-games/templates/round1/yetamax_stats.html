<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CortiX Games</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="stylesheet" href="/static/auth.css">
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="stylesheet" href="/math-games/static/css/round1/yetamax.css">
</head>
<body>
{% if current_user %}
    <div class="auth-bar">
        <a href="/" class="home-link" aria-label="Home">üè†</a>
    </div>
{% endif %}

    <div class="yetamax-container">
        <header class="yetamax-header">
            <div>
                <h1>Round 1 Stats</h1>
                <p class="subtitle">Score distribution and difficulty snapshot</p>
            </div>
            <div class="actions">
                <a class="link" href="/math-game">Play</a>
                <a class="link" href="/math-game/leaderboard">Leaderboard</a>
            </div>
        </header>

        <section class="panel">
            <h2>Score distribution</h2>
            <div id="histogram" class="histogram"></div>
        </section>

        <section class="panel">
            <h2>Difficulty snapshot</h2>
            <p class="muted" id="difficulty-note">Loading question difficulty‚Ä¶</p>
            <div class="difficulty-grid" id="difficulty-grid"></div>
        </section>
    </div>

    <script>
        function renderHistogram(buckets) {
            const container = document.getElementById('histogram');
            container.innerHTML = '';
            if (!buckets.length) {
                container.textContent = 'No runs yet. Play a round to populate the stats!';
                return;
            }
            const maxCount = Math.max(...buckets.map(b => b.count));
            buckets.forEach((b) => {
                const bar = document.createElement('div');
                bar.className = 'bar';
                const height = maxCount ? (b.count / maxCount) * 100 : 0;
                bar.style.height = `${height}%`;
                bar.title = `${b.min}-${b.max}: ${b.count}`;
                const label = document.createElement('span');
                label.textContent = `${b.min}-${b.max}`;
                bar.appendChild(label);
                container.appendChild(bar);
            });
        }

        function renderDifficulty(summary) {
            const grid = document.getElementById('difficulty-grid');
            const note = document.getElementById('difficulty-note');
            grid.innerHTML = '';
            const hardest = summary.hardest_questions || [];
            const easiest = summary.easiest_questions || [];
            if (!hardest.length && !easiest.length) {
                note.textContent = 'Difficulty modeling coming soon ‚Äî data will appear here once implemented.';
                return;
            }
            note.textContent = '';
            const renderSection = (title, list) => {
                const section = document.createElement('div');
                section.className = 'difficulty-section';
                const heading = document.createElement('h3');
                heading.textContent = title;
                section.appendChild(heading);
                if (!list.length) {
                    const p = document.createElement('p');
                    p.textContent = 'No data yet.';
                    section.appendChild(p);
                } else {
                    const table = document.createElement('table');
                    table.innerHTML = `
                        <thead><tr><th>Expression</th><th>Avg time (s)</th><th>Avg wrong</th><th>Samples</th></tr></thead>
                        <tbody></tbody>
                    `;
                    const tbody = table.querySelector('tbody');
                    list.forEach((item) => {
                        const expr = `${item.a} ${item.operator} ${item.b}`;
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${expr}</td>
                            <td>${((item.avg_time_ms || 0) / 1000).toFixed(2)}</td>
                            <td>${(item.avg_wrong_attempts || 0).toFixed(2)}</td>
                            <td>${item.samples || 0}</td>
                        `;
                        tbody.appendChild(row);
                    });
                    section.appendChild(table);
                }
                grid.appendChild(section);
            };
            renderSection('Hardest', hardest);
            renderSection('Easiest', easiest);
        }

        fetch('/api/math-game/yetamax/score-distribution')
            .then((resp) => resp.json())
            .then((data) => renderHistogram(data.buckets || []))
            .catch(() => {
                const container = document.getElementById('histogram');
                container.textContent = 'Could not load score distribution.';
            });

        fetch('/api/math-game/yetamax/difficulty-summary')
            .then((resp) => resp.json())
            .then((data) => renderDifficulty(data))
            .catch(() => {
                const note = document.getElementById('difficulty-note');
                note.textContent = 'Could not load difficulty data.';
            });
    </script>
</body>
</html>
