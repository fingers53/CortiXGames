<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>CortiX Profile</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="stylesheet" href="/static/auth.css">
    <style>
        body { background: linear-gradient(135deg, #f5f7ff, #e0f2fe); color: #0f172a; font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        .page { max-width: 1100px; margin: 0 auto; padding: 32px 16px 80px; }
        .hero { display: flex; justify-content: space-between; align-items: flex-start; gap: 24px; flex-wrap: wrap; }
        .card { background: #ffffff; border: 1px solid #dce6f5; border-radius: 16px; padding: 20px; box-shadow: 0 12px 30px rgba(37, 99, 235, 0.12); }
        .profile-card { flex: 1 1 320px; }
        .muted { color: #475569; }
        .flag { font-size: 24px; margin-right: 10px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 16px; margin-top: 16px; }
        .label { font-size: 13px; text-transform: uppercase; letter-spacing: 0.05em; color: #6b7280; margin-bottom: 6px; }
        .value { font-weight: 700; font-size: 20px; color: #0f172a; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; margin-top: 12px; }
        select, input[type="text"], input[type="checkbox"] { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #cbd5e1; background: #f8fafc; color: #0f172a; }
        button.primary { background: linear-gradient(135deg, #4f46e5, #0ea5e9); color: white; border: none; padding: 12px 18px; border-radius: 12px; font-weight: 700; cursor: pointer; box-shadow: 0 10px 25px rgba(14,165,233,0.25); }
        .section-title { display: flex; justify-content: space-between; align-items: center; margin-top: 28px; margin-bottom: 10px; }
        .card-title { font-size: 18px; font-weight: 700; margin-bottom: 8px; color: #0f172a; }
        .subtext { font-size: 14px; color: #475569; }
        .badge { padding: 8px 12px; border-radius: 999px; background: #e0f2fe; color: #0f172a; font-size: 13px; }
        .achievements { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; }
        .achievement { border: 1px solid #dce6f5; border-radius: 12px; padding: 12px; background: #f8fafc; }
        .achievement.earned { border-color: #22c55e; background: #ecfdf3; box-shadow: 0 8px 20px rgba(34,197,94,0.15); }
        .achievement .code { font-family: monospace; color: #6b7280; font-size: 13px; }
        .radar-placeholder { height: 240px; display: grid; place-items: center; color: #475569; border: 1px dashed #cbd5e1; border-radius: 12px; background: #f8fafc; }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 12px; }
        .metric-row { display: flex; justify-content: space-between; margin: 6px 0; color: #0f172a; }
        .pill { padding: 6px 10px; border-radius: 10px; background: #e2e8f0; font-size: 13px; color: #0f172a; }
        .share-btn { display: inline-flex; align-items: center; gap: 8px; cursor: pointer; background: #e0f2fe; padding: 10px 14px; border-radius: 10px; color: #0f172a; border: 1px solid #cbd5e1; box-shadow: 0 8px 18px rgba(37, 99, 235, 0.18); }
        .notice { margin-top: 10px; color: #16a34a; }
    </style>
</head>
<body>
    <div class="auth-bar">
        <div class="app-brand">
            <a href="/" class="brand-link">CORTIX <span>Games</span></a>
        </div>
        <div class="nav-actions">
            <a href="/" class="nav-button">Home</a>
            {% if current_user %}
            <span class="user-chip">Logged in as <a href="/profile" class="nav-link">{{ current_user.username }}</a></span>
            {% else %}
            <a class="nav-link" href="/login">Sign in</a>
            {% endif %}
        </div>
    </div>

    <div class="page" id="profile-root" data-username="{{ profile_user.username }}" data-owner="{{ '1' if is_owner else '0' }}">
        <div class="hero">
            <div class="card profile-card">
                <div class="label">Username</div>
                <div class="value">{{ profile_user.username }}</div>
                <div class="subtext">Joined {{ profile_user.created_at.date() if profile_user.created_at else '—' }}</div>
                <div class="grid">
                    <div>
                        <div class="label">Country</div>
                        <div class="value">{{ profile_user.country_code or '??' }}</div>
                    </div>
                    <div>
                        <div class="label">Sex</div>
                        <div class="value">{{ profile_user.sex or '—' }}</div>
                    </div>
                    <div>
                        <div class="label">Age band</div>
                        <div class="value">{{ profile_user.age_band or '—' }}</div>
                    </div>
                    <div>
                        <div class="label">Handedness</div>
                        <div class="value">{{ profile_user.handedness or '—' }}</div>
                    </div>
                    <div>
                        <div class="label">Visibility</div>
                        <div class="value">{{ 'Public' if profile_user.is_public else 'Private' }}</div>
                    </div>
                </div>
                {% if is_owner %}
                <form method="POST" action="/profile" class="form-grid" style="margin-top:16px;">
                    <div>
                        <div class="label">Country code</div>
                        <input type="text" name="country_code" maxlength="2" value="{{ profile_user.country_code or '' }}" placeholder="US">
                    </div>
                    <div>
                        <div class="label">Sex</div>
                        <select name="sex">
                            <option value="prefer_not_to_say" {% if profile_user.sex=='prefer_not_to_say' or not profile_user.sex %}selected{% endif %}>Prefer not to say</option>
                            <option value="female" {% if profile_user.sex=='female' %}selected{% endif %}>Female</option>
                            <option value="male" {% if profile_user.sex=='male' %}selected{% endif %}>Male</option>
                            <option value="other" {% if profile_user.sex=='other' %}selected{% endif %}>Other</option>
                        </select>
                    </div>
                    <div>
                        <div class="label">Age band</div>
                        <select name="age_band">
                            <option value="prefer_not_to_say" {% if profile_user.age_band=='prefer_not_to_say' or not profile_user.age_band %}selected{% endif %}>Prefer not to say</option>
                            <option value="18-20" {% if profile_user.age_band=='18-20' %}selected{% endif %}>18-20</option>
                            <option value="21-23" {% if profile_user.age_band=='21-23' %}selected{% endif %}>21-23</option>
                            <option value="24-26" {% if profile_user.age_band=='24-26' %}selected{% endif %}>24-26</option>
                            <option value="27-29" {% if profile_user.age_band=='27-29' %}selected{% endif %}>27-29</option>
                            <option value="30-32" {% if profile_user.age_band=='30-32' %}selected{% endif %}>30-32</option>
                            <option value="33-35" {% if profile_user.age_band=='33-35' %}selected{% endif %}>33-35</option>
                            <option value="36-38" {% if profile_user.age_band=='36-38' %}selected{% endif %}>36-38</option>
                            <option value="39-41" {% if profile_user.age_band=='39-41' %}selected{% endif %}>39-41</option>
                            <option value="42-44" {% if profile_user.age_band=='42-44' %}selected{% endif %}>42-44</option>
                            <option value="45+" {% if profile_user.age_band=='45+' %}selected{% endif %}>45+</option>
                        </select>
                    </div>
                    <div>
                        <div class="label">Handedness</div>
                        <select name="handedness">
                            <option value="right" {% if profile_user.handedness=='right' %}selected{% endif %}>Right-handed</option>
                            <option value="left" {% if profile_user.handedness=='left' %}selected{% endif %}>Left-handed</option>
                            <option value="ambidextrous" {% if profile_user.handedness=='ambidextrous' %}selected{% endif %}>Ambidextrous</option>
                        </select>
                    </div>
                    <div style="display:flex; align-items:center; gap:8px;">
                        <input type="checkbox" id="is_public" name="is_public" value="1" {% if profile_user.is_public %}checked{% endif %}>
                        <label for="is_public" class="muted">Public profile</label>
                    </div>
                    <div>
                        <button type="submit" class="primary">Save profile</button>
                    </div>
                </form>
                <p class="subtext" style="margin-top:8px;">Sex, age band, and handedness are used only for aggregated, anonymized statistics and psychometric summaries.</p>
                {% endif %}
                <div style="margin-top:14px; display:flex; gap:12px; flex-wrap:wrap;">
                    <button class="share-btn" id="share-btn">Share profile</button>
                    {% if not profile_user.is_public %}<span class="muted">Profile is private</span>{% endif %}
                </div>
                <div id="share-notice" class="notice" style="display:none;">Link copied!</div>
            </div>
            <div class="card" style="flex:1 1 320px;">
                <div class="card-title">Brain radar</div>
                <div class="subtext">Snapshot of speed, accuracy, memory, consistency, and engagement.</div>
                <canvas id="radarChart" aria-label="Radar chart"></canvas>
                <div class="radar-placeholder" id="radarPlaceholder">Loading radar…</div>
            </div>
        </div>

        <div class="section-title">
            <h3>Game breakdown</h3>
            <span class="muted">Performance across each round</span>
        </div>
        <div class="metrics-grid">
            <div class="card" id="reaction-card"></div>
            <div class="card" id="memory-card"></div>
            <div class="card" id="math-card"></div>
        </div>

        <div class="section-title">
            <h3>Achievements</h3>
            <span class="muted">Earn badges by playing and improving</span>
        </div>
        <div class="achievements" id="achievements-grid"></div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/static/js/profile.js"></script>
</body>
</html>
